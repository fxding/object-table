/**
 * object-table - angular smart table directive
 * @version v0.2.10
 * @author Yauheni Kokatau
 * @license MIT
 */
"use strict";angular.module("objectTable",[]).directive("contenteditable",function(){return{restrict:"A",require:["ngModel","^objectTable"],link:function(e,t,r,n){var a=n[0],i=n[1];a.$render=function(){t.html(a.$viewValue||"")},t.bind("change blur",function(){var r=a.$viewValue.toString(),n=t.text();r!==n&&(e.$apply(function(){a.$setViewValue(n)}),i.onEdit&&"function"==typeof i.onEdit&&i.onEdit({$oldValue:r,$newValue:n}))})}}}),angular.module("objectTable").directive("objectTable",["$compile","$interpolate",function(e,t){return{restrict:"A",replace:!0,templateUrl:"/src/templates/common.html",controller:"objectTableCtrl",controllerAs:"ctrl",transclude:!0,scope:{data:"=",loading:"=?",display:"=?",resize:"=?",paging:"=?",fromUrl:"@",sortingType:"@?sorting",hideSortBadge:"=?",editable:"&?",select:"@?",selectedModel:"=?",dragColumns:"=?",onEdit:"&?",onDrag:"&?"},compile:function(e,t){var r="",n="";return t.addFilter&&(r+=t.addFilter),"false"!==t.sorting&&(r+="| orderBy:sortingArray"),t.dragColumns&&e.find("th").attr("allow-drag",""),"separate"===t.search?t.fields.split(",").forEach(function(e,t){r+="| filter:{'"+e.trim()+"':columnSearch['"+e+"']}"}):"undefined"!=typeof t.search&&"true"!==t.search||(r+="| filter:ctrl.globalSearch"),n+=" | offset: currentPage:display |limitTo: display",e[0].querySelector("#rowTr").setAttribute("ng-repeat","item in $parent.$filtered = (data"+r+")"+n),e.find("paging").attr("count","$filtered.length"),function(e,t,a,i,o){i._init(),o(e,function(t,a){e.$owner=a.$parent;for(var o in t)if(t.hasOwnProperty(o))switch(t[o].tagName){case"THEAD":i._addHeaderPattern(t[o]);break;case"TBODY":e.findBody=!0,i._addRowPattern(t[o],r,n);break;case"TFOOT":i._addFooterPattern(t[o])}})}}}}]),angular.module("objectTable").directive("allowDrag",function(){return{restrict:"A",controller:function(){},compile:function(e,t){function r(e,t){var r=e[0].parentNode.querySelector("."+t);r&&r.classList.remove(t)}return function(e,t,n,a){t.attr("draggable",!0),t.bind("dragstart",function(e){a.target=this,this.classList.add("dragged");var t=e.originalEvent||e;t.dataTransfer.setData("text",a.target.cellIndex)}),t.bind("dragover",function(e){e.preventDefault()}),t.bind("dragenter",function(e){a.toTarget=this,this.classList.contains("draggedOver")||this.classList.contains("dragged")||this.classList.add("draggedOver"),e.preventDefault(),e.stopPropagation()}),t.bind("dragend",function(e){this.classList.contains("dragged")&&this.classList.remove("dragged"),e.preventDefault()}),t.bind("dragleave",function(e){this.classList.remove("draggedOver")}),t.bind("drop",function(e){var n=a.toTarget.cellIndex,i=e.originalEvent||e,o=parseInt(i.dataTransfer.getData("text"),10);r(t,"dragged"),r(t,"draggedOver"),t.parent().controller("objectTable").changeColumnsOrder(n,o),e.preventDefault()})}}}}),angular.module("objectTable").controller("objectTableCtrl",["$scope","$timeout","$element","$attrs","$http","$compile","$controller","$parse","objectTableUtilService",function(e,t,r,n,a,i,o,l,s){o("objectTableSortingCtrl",{$scope:e});var c=this;this._init=function(){e.headers=[],e.fields=[],e.display=e.display||10,e.paging=angular.isDefined(e.paging)?e.paging:!0,e.sortingType=e.sortingType||"simple",e.currentPage=0,e.customHeader=!1,"separate"==n.search?(e.search="separate",e.columnSearch=[]):e.search="undefined"==typeof n.search||"true"===n.search,e.headers=s.getArrayFromParams(n.headers,"headers"),e.fields=s.getArrayFromParams(n.fields,"fields"),n.fromUrl&&this._loadExternalData(n.fromUrl),e.onEdit&&(this.onEdit=e.onEdit),n.tableClasses&&(e.customClasses=n.tableClasses),e.selectedModel="multiply"===e.select?[]:{}},this.onEdit=e.onEdit,this._loadExternalData=function(t){e.loading=!0,a.get(t).then(function(t){e.data=t.data,e.loading=!1})},this._addHeaderPattern=function(t){e.customHeader=!0,Array.prototype.forEach.call(t.querySelectorAll("[allow-drag]"),function(e,t){e.setAttribute("index",t)}),t.removeAttribute("ng-non-bindable"),r.find("table").prepend(t)},this._addFooterPattern=function(e){r.find("table").prepend(e)},this._addRowPattern=function(t,n,a){this._checkEditableContent(t),this._addRepeatToRow(t,n,a),t.removeAttribute("ng-non-bindable"),r.find("table").append(t.outerHTML),this.bodyTemplate=t.innerHTML,i(r.find("tbody"))(e)},this._addRepeatToRow=function(e,t,r){var n=angular.element(e).find("tr");n.attr("ng-repeat","item in $filtered = (data"+t+")"+r),n.attr("ng-click")||n.attr("ng-click","setSelected(item)"),n.attr("ng-class","{'selected-row':ifSelected(item)}")},this._checkEditableContent=function(e){var t,r=/\{\{:*:*(.*?)\}\}/g;Array.prototype.forEach.call(e.querySelectorAll("[editable]"),function(e){t=e.innerHTML.replace(r,"$1"),e.innerHTML="<div contentEditable ng-model='"+t+"'>{{"+t+"}}</div>"})},e.createGetterSetter=function(e,t){var r=l(t),n=r.assign;return function(t){return arguments.length?n(e,t):r(e)}},e.getModelValue=function(e,t){var r=l(t);return r(e)},this.setCurrentPage=function(t){e.currentPage=t},e.settable=function(){var t=e.select;return!("false"===t||t===!1)},e.setSelected=function(t){e.settable()&&("multiply"===e.select?c._containsInSelectArray(t)?e.selectedModel.splice(e.selectedModel.indexOf(t),1):e.selectedModel.push(t):e.selectedModel=t)},this._containsInSelectArray=function(t){return e.selectedModel.length?e.selectedModel.filter(function(e){return angular.equals(e,t)}).length>0:void 0},e.ifSelected=function(t){return e.settable()?e.selectedModel&&"multiply"===e.select?c._containsInSelectArray(t):t.$$hashKey==e.selectedModel.$$hashKey:void 0},this.changeColumnsOrder=function(t,n){e.$apply(function(){e.fields.swap(t,n);var a=e.headers.slice();if(e.headers.swap(t,n),e.onDrag&&"function"==typeof e.onDrag&&e.onDrag({$oldOrder:a,$newOrder:e.headers}),a=null,e.columnSearch&&e.columnSearch.swap(t,n),c.bodyTemplate){var o=angular.element(c.bodyTemplate).children(),l=document.createElement("tr"),s=document.createElement("tbody"),d=r.find("tbody").find("tr")[0].attributes;Array.prototype.swap.apply(o,[t,n]),[].forEach.call(d,function(e,t){l.setAttribute(e.name,e.value)});for(var u=0,g=o.length;g>u;u++)l.appendChild(o[u]);s.appendChild(l),r.find("tbody").replaceWith(s),c.bodyTemplate=s.innerHTML,i(r.find("tbody"))(e)}if(e.customHeader){var p=r.find("th"),l=document.createElement("tr"),f=document.createElement("thead");Array.prototype.swap.apply(p,[t,n]);for(var u=0,g=p.length;g>u;u++)l.appendChild(p[u]);f.appendChild(l),r.find("thead").replaceWith(f)}c.pageCtrl&&c.pageCtrl.setPage(0)})},e.setCurrentPageForPageCtrl=function(e){c.pageCtrl&&c.pageCtrl.setPage(e)}}]),angular.module("objectTable").filter("offset",function(){return function(e,t,r){if(e){t=parseInt(t,10),r=parseInt(r,10);var n=t*r;return e.slice(n,n+r)}}}),angular.module("objectTable").controller("pagingTableCtrl",["$scope","$element","$attrs",function(e,t,r){e.currentPage=0,e.prevPage=function(){e.currentPage>0&&e.currentPage--,e.setCurrentPageToTable()},e.nextPage=function(){e.currentPage<e.pageCount()&&e.currentPage++,e.setCurrentPageToTable()},e.setCurrentPageToTable=function(){e.objectTableCtrl.setCurrentPage(e.currentPage)},e.prevPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.pageCount=function(){return e.count>0?Math.ceil(e.count/e.display)-1:0},e.nextPageDisabled=function(){return e.currentPage===e.pageCount()?"disabled":""},e.setPage=function(t){e.currentPage=t,e.setCurrentPageToTable()},e.range=function(){var t=e.pageCount()+1<5?e.pageCount()+1:5,r=[],n=e.currentPage;n>e.pageCount()-t&&(n=e.pageCount()-t+1);for(var a=n;n+t>a;a++)r.push(a);return r}}]),angular.module("objectTable").controller("objectTableSortingCtrl",["$scope",function(e){function t(e){i&&(r.width=a+(e.pageX-n))}e.sort={fields:[],ascending:[]},e.sortingArray=[],e.sortBy=function(t){if(o)return void(o=!1);if(e.data.length){var r=e.headers[e.fields.indexOf(t)];"compound"==e.sortingType?-1==e.sort.fields.indexOf(r)?(e.sort.fields.push(r),e.sortingArray.push(t),e.sort.ascending.push(!0)):e.changeReversing(t,e.sort.fields.indexOf(r)):"simple"==e.sortingType&&(e.sort.fields=[r],e.changeReversing(t))}},e.changeReversing=function(t,r){"compound"==e.sortingType?(e.sort.ascending[r]=!e.sort.ascending[r],e.sortingArray[r]=e.sort.ascending[r]?t:"-"+t):"simple"==e.sortingType&&(e.sort.ascending[0]=!e.sort.ascending[0],e.sortingArray=e.sort.ascending[0]?[t]:["-"+t])},e.headerIsSortedClass=function(t){if(e.sortingArray.length)if("simple"==e.sortingType){if(t==e.sort.fields[0]||"-"+t==e.sort.fields[0])return e.sort.ascending[0]?"table-sort-up":"table-sort-down"}else if("compound"==e.sortingType){var r=e.sort.fields.indexOf(t);if(-1!=r)return e.sort.ascending[r]?"table-sort-up":"table-sort-down"}},e.removeSorting=function(){var t=e.sort.fields.indexOf(this.sortField);t>-1&&(e.sort.fields.splice(t,1),e.sort.ascending.splice(t,1),e.sortingArray.splice(t,1)),t=null};var r,n,a,i=!1,o=!1;e.resizeStart=function(e){var o=e.target?e.target:e.srcElement;o.classList.contains("resize")&&(r=o.parentNode,i=!0,n=e.pageX,a=o.parentNode.offsetWidth,document.addEventListener("mousemove",t),e.stopPropagation(),e.preventDefault())},e.resizeEnd=function(e){i&&(document.removeEventListener("mousemove",t),e.stopPropagation(),e.preventDefault(),i=!1,o=!0)}}]),angular.module("objectTable").service("objectTableUtilService",[function(){return Array.prototype.swap=function(e,t){if(e>=this.length)for(var r=e-this.length;r--+1;)this.push(void 0);return this.splice(e,0,this.splice(t,1)[0]),this},{getArrayFromParams:function(e,t){if(!e)throw"Required '"+t+"' attribute is not found!";for(var r=[],n=e.split(","),a=0,i=n.length;i>a;a++)r.push(n[a].trim());return r}}}]),angular.module("objectTable").directive("paging",["$compile","$interpolate",function(e,t){return{restrict:"E",replace:!0,templateUrl:"/src/templates/paging.html",controller:"pagingTableCtrl",require:"^objectTable",scope:{count:"=",display:"="},link:function(e,t,r,n){e.objectTableCtrl=n,e.objectTableCtrl.pageCtrl=e}}}]);
angular.module("objectTable").run(["$templateCache", function($templateCache) {$templateCache.put("/src/templates/common.html","<div class=\"object-table-module\"><div class=\"top-container container-fluid\" ng-if=\"(!hideSortBadge && !!sorting) || (search && \'separate\'!=search)\"><div class=\"row\"><div class=\"col-xs-12 col-sm-6 col-md-8\" style=\"padding: 0\"><div ng-if=\"sortingType && sort.fields.length && !hideSortBadge\" class=\"sorting-container\"><button ng-repeat=\"sortField in sort.fields\" class=\"sorting-badge\" ng-click=\"sortBy(fields[headers.indexOf(sortField)])\"><span class=\"glyphicon\" ng-class=\"{\'glyphicon-chevron-down\':!sort.ascending[$index], \'glyphicon-chevron-up\':sort.ascending[$index]}\"></span> {{::sortField}} <span class=\"glyphicon glyphicon-remove close\" ng-click=\"removeSorting()\"></span></button></div></div><div class=\"col-xs-12 col-sm-6 col-md-4\" ng-if=\"search && \'separate\'!=search\" style=\"padding: 0\"><div class=\"search-container\"><input type=\"text\" placeholder=\"Search\" ng-model=\"ctrl.globalSearch\" class=\"pull-right form-control search\" ng-model-options=\"{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }\" ng-change=\"setCurrentPageForPageCtrl(0)\"> <i class=\"glyphicon glyphicon-search search_icon\"></i></div></div></div></div><div class=\"back-cover table-responsive\"><table class=\"table object-table\" ng-class=\"customClasses\" ng-mousedown=\"resizeStart($event)\" ng-mouseup=\"resizeEnd($event)\"><thead ng-if=\"!customHeader\"><tr><th ng-repeat=\"head in headers track by $index\" ng-click=\"sortBy(fields[$index])\" ng-class=\"headerIsSortedClass(head)\" class=\"sortable\">{{head}}<div ng-if=\"resize\" class=\"resize\"></div></th></tr></thead><thead ng-if=\"!customHeader&& \'separate\'===search\"><tr><th ng-repeat=\"head in headers track by $index\" class=\"separate\"><i class=\"glyphicon glyphicon-search search_icon separate\"></i> <input type=\"text\" ng-model=\"columnSearch[fields[$index]]\" placeholder=\"{{head}}...\" class=\"form-control search separate\" ng-model-options=\"{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }\" ng-change=\"setCurrentPageForPageCtrl(0)\"></th></tr></thead><tbody ng-if=\"!findBody\"><tr id=\"rowTr\" ng-click=\"setSelected(item)\" ng-class=\"{\'selected-row\':ifSelected(item)}\"><!-- <= will inject ng-repeat --><!-- params: headers and fields --><td ng-if=\"!editable\" ng-repeat=\"field in fields\">{{getModelValue(item, field)}}</td><td ng-if=\"editable\" editable ng-repeat=\"field in fields\"><div contenteditable ng-model=\"createGetterSetter(item, field)\" ng-model-options=\"{getterSetter: true}\">{{getModelValue(item, field)}}</div></td></tr></tbody></table></div><div class=\"loading\" ng-show=\"loading\"><span class=\"glyphicon glyphicon-refresh glyphicon-refresh-animate\"></span> Loading Data...</div><paging ng-if=\"paging\" data-display=\"display\" count=\"$filtered.length\" class=\"object-table-paging\" ng-hide=\"dataIsLoading\"></paging><div class=\"clearfix\"></div></div>");
$templateCache.put("/src/templates/paging.html","<div><div class=\"col-xs-9\"><nav ng-hide=\"pageCount()==0\"><ul class=\"pagination\"><li ng-class=\"prevPageDisabled()\"><a href ng-click=\"prevPage()\">« Prev</a></li><li ng-repeat=\"n in range()\" ng-class=\"{active: n == currentPage}\" ng-click=\"setPage(n)\"><a href=\"javascript:void(0)\">{{::n+1}}</a></li><li ng-class=\"nextPageDisabled()\"><a href ng-click=\"nextPage()\">Next »</a></li></ul></nav></div><div class=\"col-xs-3\"><span class=\"label label-default count\">{{count}} <span class=\"records\">records</span></span></div></div>");}]);